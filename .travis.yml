os: linux
dist: focal

language: python
python:
- "3.7"
- "3.8"
- "3.9"
- "3.10"
- "pypy3"

env:
- DEBIAN_DEPS=true
- DEBIAN_DEPS=

install:
- python -m pip install --upgrade pip setuptools wheel
- python -m pip --version
- python -m pip install --upgrade pytest pylint flake8
- if [ "$TRAVIS_PYTHON_VERSION" != "pypy3" ]; then python -m pip install --upgrade mypy; fi
- if [   $DEBIAN_DEPS ]; then python -m pip install --upgrade cryptography==3.3.2 pydantic==1.7.4; fi
- if [ ! $DEBIAN_DEPS ]; then python -m pip install --upgrade cryptography        pydantic; fi
- python -m pip install .

script:
- if [ "$TRAVIS_PYTHON_VERSION" != "pypy3" ]; then python -m mypy --strict doubleratchet/; fi
- if [ "$TRAVIS_PYTHON_VERSION" != "pypy3" ]; then python -m mypy --strict tests/; fi
- if [ "$TRAVIS_PYTHON_VERSION" != "pypy3" ]; then python -m mypy --strict examples/; fi
- if [ "$TRAVIS_PYTHON_VERSION" != "pypy3" ]; then python -m mypy --strict setup.py; fi
- python -m pylint doubleratchet/
- python -m pylint tests/*.py
- python -m pylint examples/*.py
- python -m pylint setup.py
- python -m flake8 doubleratchet/
- python -m flake8 tests/*.py
- python -m flake8 examples/*.py
- python -m flake8 setup.py
- python -m pytest
